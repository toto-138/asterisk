<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pemain | Permainan ADIL</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
<style>
  body {
    background: radial-gradient(circle at center, #064e3b, #022c22);
    color: white;
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
  }
  .board {
    background: rgba(4, 120, 87, 0.35);
    padding: 0.8rem;
    border-radius: 1rem;
    transition: transform 0.3s ease;
  }
  .board table {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
  }
  .board th {
    background: #065f46;
    color: #d1fae5;
    padding: 0.5rem;
    border-radius: 0.3rem;
  }
  .board td {
    padding: 0.5rem;
  }
  .cell {
    display: inline-block;
    background: #10b981;
    border-radius: 0.5rem;
    font-weight: 700;
    width: 50px;
    height: 50px;
    line-height: 50px;
    cursor: pointer;
    transition: all 0.25s ease;
  }
  .cell:hover { transform: scale(1.05); }
  .cell.checked {
    background: #0a1950;
    color: #a3c4ff;
    box-shadow: inset 0 0 8px #1e3a8a;
  }
  #latest-number {
    font-size: 4rem;
    font-weight: 800;
    margin: 1rem 0;
    color: #6ee7b7;
    text-shadow: 0 0 20px rgba(16,185,129,0.7);
  }
  #latest-number.pop {
    transform: scale(1.2);
    text-shadow: 0 0 40px rgba(16,185,129,1);
  }
  .btn {
    background: #10b981;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 600;
    color: #fff;
    transition: all 0.2s;
  }
  .btn:hover { background: #34d399; transform: scale(1.05); }

  #options-panel {
    position: absolute;
    top: 90px;
    right: 20px;
    width: 18rem;
    backdrop-filter: blur(14px);
    background: rgba(0,255,204,0.1);
    border: 1px solid rgba(0,255,204,0.25);
    border-radius: 1rem;
    padding: 1rem;
    display: none;
    animation: slideDown 0.4s ease;
    box-shadow: 0 0 25px rgba(0,255,204,0.3);
    z-index: 100;
  }
  @keyframes slideDown {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  #riwayat {
    text-align: left;
    font-family: monospace;
    font-size: 0.9rem;
    color: #aafff4;
    max-height: 200px;
    overflow-y: auto;
    margin-top: 0.5rem;
    white-space: pre-wrap;
    border-top: 1px solid rgba(0,255,204,0.2);
    padding-top: 0.5rem;
  }
</style>
</head>
<body class="flex flex-col items-center p-4">

<header class="w-full flex justify-between items-center mb-4">
  <h1 class="text-xl font-bold text-emerald-300">üéØ Permainan ADIL ‚Äî Pemain</h1>
  <button id="btnOpsi" class="btn">‚öôÔ∏è Opsi</button>
</header>

<div class="text-center">
  <div class="text-emerald-200 text-sm">Angka Terbaru:</div>
  <div id="latest-number">--</div>
</div>

<div id="boards-container" class="grid gap-4 w-full max-w-6xl justify-center"></div>

<div id="options-panel" class="text-center">
  <label for="jumlah-papan" class="block text-emerald-100 mb-1">Tampilkan Berapa Papan:</label>
  <select id="jumlah-papan" class="w-full mb-2">
    <option value="1">1 papan</option>
    <option value="2">2 papan</option>
    <option value="3">3 papan</option>
    <option value="4">4 papan</option>
    <option value="5">5 papan</option>
    <option value="6">6 papan</option>
    <option value="7">7 papan</option>
    <option value="8">8 papan</option>
    <option value="9">9 papan</option>
    <option value="10">10 papan</option>
  </select>
  <button id="btnGanti" class="btn w-full mb-2">üé≤ GANTI SEMUA PAPAN</button>
  <button id="btnReset" class="btn w-full mb-2">‚ôªÔ∏è RESET CENTANG</button>
  <div class="mt-2 text-left text-emerald-100 font-semibold">üìú Riwayat Angka Keluar</div>
  <div id="riwayat"></div>
  <button id="btnTutup" class="btn w-full mt-3 bg-red-600 hover:bg-red-700">‚ùå Tutup</button>
</div>

<script>
const dingSound = new Audio('./sounds/ding.mp3');
dingSound.volume = 0.5;
const HEADER = ['A','D','I','L'];

let boards = JSON.parse(localStorage.getItem('adil-boards')) || {};
let jumlahPapan = Number(localStorage.getItem('adil-jumlah')) || 1;
let checkedCells = JSON.parse(localStorage.getItem('adil-checked')) || {};
let riwayat = JSON.parse(localStorage.getItem('adil-riwayat')) || { A:[], D:[], I:[], L:[] };

const boardsContainer = document.getElementById('boards-container');
const riwayatDiv = document.getElementById('riwayat');

// üî¢ Fungsi baru: buat papan dengan duplikat tapi tidak di kolom sama
function generateBoard(num) {
  const baseNums = Array.from({ length: 50 }, (_, i) => i + 1);
  const selected = [];
  while (selected.length < 12) {
    const n = baseNums.splice(Math.floor(Math.random() * baseNums.length), 1)[0];
    selected.push(n);
  }
  const duplicateCount = Math.floor(Math.random() * 3) + 2;
  const duplicates = [];
  for (let i = 0; i < duplicateCount; i++) {
    const dup = selected[Math.floor(Math.random() * selected.length)];
    duplicates.push(dup);
  }
  const allNums = [...selected];
  for (let dup of duplicates) {
    allNums.push(dup);
  }

  // posisikan di grid 4x4 tanpa duplikat di kolom sama
  const grid = Array(4).fill(null).map(() => Array(4).fill(null));
  const positions = [];
  for (let r = 0; r < 4; r++) for (let c = 0; c < 4; c++) positions.push([r,c]);
  const shuffled = positions.sort(() => Math.random() - 0.5);

  const placed = {};
  for (let n of allNums) {
    let placedOK = false;
    for (let pos of shuffled) {
      const [r, c] = pos;
      if (!grid[r][c]) {
        const sameColNums = grid.map(row => row[c]).filter(x => x !== null);
        if (!sameColNums.includes(n)) {
          grid[r][c] = n;
          placedOK = true;
          break;
        }
      }
    }
    if (!placedOK) {
      for (let pos of shuffled) {
        const [r, c] = pos;
        if (!grid[r][c]) {
          grid[r][c] = n;
          break;
        }
      }
    }
  }
  boards[num] = grid.flat();
}

if (Object.keys(boards).length < 10) {
  for (let i = 1; i <= 10; i++) generateBoard(i);
  localStorage.setItem('adil-boards', JSON.stringify(boards));
}

function saveChecked() {
  localStorage.setItem('adil-checked', JSON.stringify(checkedCells));
}

function saveRiwayat() {
  localStorage.setItem('adil-riwayat', JSON.stringify(riwayat));
  renderRiwayat();
}

function renderRiwayat() {
  const lines = [];
  const maxLen = Math.max(riwayat.A.length, riwayat.D.length, riwayat.I.length, riwayat.L.length);
  for (let i = 0; i < maxLen; i++) {
    const a = riwayat.A[i] ? `A:${riwayat.A[i]}`.padEnd(6) : "      ";
    const d = riwayat.D[i] ? `D:${riwayat.D[i]}`.padEnd(6) : "      ";
    const iN = riwayat.I[i] ? `I:${riwayat.I[i]}`.padEnd(6) : "      ";
    const l = riwayat.L[i] ? `L:${riwayat.L[i]}` : "";
    lines.push(`${a}  ${d}  ${iN}  ${l}`);
  }
  riwayatDiv.textContent = lines.join("\n") || "(belum ada angka keluar)";
}

function renderBoards() {
  boardsContainer.innerHTML = '';
  for (let n = 1; n <= jumlahPapan; n++) {
    const wrap = document.createElement('div');
    wrap.className = 'board';
    const title = document.createElement('div');
    title.textContent = `Papan #${n}`;
    title.className = 'text-center text-emerald-200 font-semibold mb-1';
    wrap.appendChild(title);

    const table = document.createElement('table');
    const trH = document.createElement('tr');
    HEADER.forEach(h => {
      const th = document.createElement('th');
      th.textContent = h;
      trH.appendChild(th);
    });
    table.appendChild(trH);

    const nums = boards[n];
    for (let r = 0; r < 4; r++) {
      const tr = document.createElement('tr');
      for (let c = 0; c < 4; c++) {
        const num = nums[r*4+c];
        const td = document.createElement('td');
        const div = document.createElement('div');
        div.className = 'cell';
        div.textContent = num.toString().padStart(2,'0');
        const key = `p${n}-${r}-${c}`;
        if (checkedCells[key]) div.classList.add('checked');
        div.onclick = () => {
          div.classList.toggle('checked');
          checkedCells[key] = div.classList.contains('checked');
          saveChecked();
        };
        td.appendChild(div);
        tr.appendChild(td);
      }
      table.appendChild(tr);
    }
    wrap.appendChild(table);
    boardsContainer.appendChild(wrap);
  }
}

function updateLatestNumber(huruf, angka) {
  const el = document.getElementById('latest-number');
  el.textContent = `${huruf}:${String(angka).padStart(2,'0')}`;
  el.classList.add('pop');
  dingSound.currentTime = 0;
  dingSound.play();
  setTimeout(()=>el.classList.remove('pop'),500);
  if (riwayat[huruf]) {
    riwayat[huruf].push(String(angka).padStart(2,'0'));
    saveRiwayat();
  }
}

window.addEventListener('storage', e => {
  if (e.key === 'adil-last-huruf') {
    const huruf = e.newValue;
    const angka = Number(localStorage.getItem('adil-last'));
    if (!isNaN(angka)) updateLatestNumber(huruf, angka);
  }
});

document.getElementById('btnOpsi').onclick = () => document.getElementById('options-panel').style.display='block';
document.getElementById('btnTutup').onclick = () => document.getElementById('options-panel').style.display='none';
document.getElementById('jumlah-papan').onchange = e => {
  jumlahPapan = Number(e.target.value);
  localStorage.setItem('adil-jumlah', jumlahPapan);
  renderBoards();
};
document.getElementById('btnGanti').onclick = () => {
  boards = {};
  for (let i = 1; i <= 10; i++) generateBoard(i);
  checkedCells = {};
  localStorage.setItem('adil-boards', JSON.stringify(boards));
  saveChecked();
  renderBoards();
};
document.getElementById('btnReset').onclick = () => {
  checkedCells = {};
  saveChecked();
  renderBoards();
};

renderBoards();
renderRiwayat();
</script>
</body>
</html>
